// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js" 
  output   = "../generated/prisma"
}

datasource db {
  provider = "sqlite"
  url      = "file:../data/moderation.db"
}

model User {
  id               Int                  @id @default(autoincrement())
  discordId        String               @unique
  
  // Relations
  actionsReceived  ModerationAction[]   @relation("ActionTarget")
  actionsPerformed ModerationAction[]   @relation("ActionModerator")
  
  @@index([discordId])
}

enum ActionType {
  WARN
  MUTE
  UNMUTE
  KICK
  BAN
  UNBAN
  TIMEOUT
  REMOVE_TIMEOUT
  REPEL
}

enum ActionStatus {
  ACTIVE
  EXPIRED
  REMOVED_BY_ERROR
  REVERSED
}

model ModerationAction {
  id             Int                  @id @default(autoincrement())
  type           ActionType
  status         ActionStatus         @default(ACTIVE)
  reason         String?
  duration       Int?                 // Duration in seconds for timeouts/mutes
  
  // User relationships
  targetId       Int
  target         User                 @relation("ActionTarget", fields: [targetId], references: [id])
  moderatorId    Int
  moderator      User                 @relation("ActionModerator", fields: [moderatorId], references: [id])
  
  // Timestamps
  createdAt      DateTime             @default(now())
  expiresAt      DateTime?
  
  // For corrections/reversals
  parentActionId Int?
  parentAction   ModerationAction?    @relation("ActionCorrections", fields: [parentActionId], references: [id])
  corrections    ModerationAction[]   @relation("ActionCorrections")
  
  @@index([targetId])
  @@index([moderatorId])
  @@index([status])
  @@index([createdAt])
}